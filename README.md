# CTFd production deploy using containers

This repository includes all the config files needed to deploy easily a CTFd platform production ready.

## Content

* data
  - certbot: Data generated by certbot to request new SSL certificates.
  - ssl: Temporal self-signed SSL certificates used by nginx.
* conf/nginx/http.conf: Nginx configuration file

## Install Requirements

You will need to install the following requirements:

* Docker 

```
apt update
apt install apt-transport-https ca-certificates curl gnupg2 software-properties-common
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -
add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stable"
apt update
apt install docker-ce
systemctl status docker
```

* Install ufw to only allow ports 80/tcp, 443/tcp, and 22/tcp

```
apt install ufw
ufw allow 80
ufw allow 443
ufw allow 22
```

* Install docker-compose

```
curl -L "https://github.com/docker/compose/releases/download/1.26.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
```

* Copy the contents of the https://github.com/CTFd/CTFd repository into your working folder.

## Configuration

* Remember to change the following values in docker-compose.yml file:
  * MYSQL_ROOT_PASSWORD
  * MYSQL_PASSWORD
  * DATABASE_URL
  * SECRET_KEY

* Put all the files in this repository into a CTFd fresh installation (overwritting the existing files).

* Use init-letsencrypt.sh to request new certificates SSL (don't forget to modify the script with the right domain name)
